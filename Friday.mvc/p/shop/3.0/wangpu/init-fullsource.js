KISSY.add("wangpu/init", function (S) {

    /*Generated by KISSY Module Compiler*/
    KISSY.config('modules', {
        'wangpu/decoration/init': { requires: ['core', 'switchable', 'overlay', 'wangpu/decoration/compatible', 'wangpu/decoration/countdown', 'datalazyload', 'wangpu/decoration/isv'] },
        'wangpu/base': { requires: ['core', 'overlay'] },
        'wangpu/mods/other/shop-factionswapper': { requires: ['core'] },
        'wangpu/mods/official/page-banner': { requires: ['core', 'overlay'] },
        'wangpu/mods/official/shopinsearch-head': { requires: ['core'] },
        'wangpu/mods/official/top-list': { requires: ['core', 'switchable', 'overlay', 'node'] },
        'wangpu/decoration/countdown': { requires: ['core'] },
        'wangpu/mods/official/customer-service': { requires: ['core', 'cookie'] },
        'wangpu/decoration/compatible': { requires: ['core'] },
        'wangpu/mods/other/guest-youlike': { requires: ['core'] },
        'wangpu/mods/official/search-list': { requires: ['core'] },
        'wangpu/mods/official/recharge-center': { requires: ['core'] },
        'wangpu/mods/official/self-defined': { requires: ['core'] },
        'wangpu/mods/official/c2c-head': { requires: ['core', 'overlay', 'suggest'] },
        'wangpu/mods/official/recharge-alimama': { requires: ['core'] }
    });

    var defaultInitConfig = {
        "assetsHost": "http://a.tbcdn.cn",     // 鍓嶇璧勬簮host鍦板潃锛屾牴鎹幆澧冭€屾湁涓嶅悓锛岄粯璁や负绾夸笂鍦板潃
        "pageType": "wangpu",                    // 搴楅摵: wangpu, 闆嗗競detail:cdetail, tmall 璇︽儏椤�: tmalldetail, 璇勪环锛� rate
        "lazyContainers": "body",               // 鍥剧墖鎳掑姞杞界殑鍖哄煙锛岀被鍨嬶細String|HTMLElement|Array<HTMLElement>
        "isvParams": {}                           // isv 缁熻闇€瑕佺殑鍙傛暟
    },
        pageTypeMods = {
            "wangpu": ["c2c-head",
                        "page-banner",
                        "shopinsearch-head",
                        "customer-service",
                        "search-list",
                        "top-list",
                        "self-defined",
                        "recharge-center",
                        "recharge-alimama"]

            , "cdetail": [
                        "page-banner",
                        "shopinsearch-head",
                        "customer-service",
                        "top-list",
                        "self-defined"]

            , "tmalldetail": [
                        "page-banner",
                        "shopinsearch-head",
                        "customer-service",
                        "top-list",
                        "self-defined"]

            , "rate": ["c2c-head",
                      "page-banner"]
        };


    var Wangpu = {
        init: function (config) {
            S.log("wangpu  init start");
            var start = (new Date()).getTime();

            var initConfig = S.merge(defaultInitConfig, config)
                , mods = [], comboMods = [];

            KISSY.config(
                {
                    combine: true,
                    packages: [
                        {
                            name: "wangpu", //鍖呭悕
                            tag: "201301151318", //鏃堕棿鎴�, 娣诲姞鍦ㄥ姩鎬佽剼鏈矾寰勫悗闈�, 鐢ㄤ簬鏇存柊鍖呭唴妯″潡浠ｇ爜
                            path: initConfig.assetsHost + "/p/shop/3.0/", //鍖呭搴旇矾寰�, 鐩稿璺緞鎸囩浉瀵逛簬褰撳墠椤甸潰璺緞    //
                            charset: "utf-8" //鍖呴噷妯″潡鏂囦欢缂栫爜鏍煎紡
                        }
                    ]
                }
            );

            mods = pageTypeMods[initConfig.pageType];

            comboMods.push("wangpu/base");
            for (var i = 0; i < mods.length; i++) {
                comboMods.push("wangpu/mods/official/" + mods[i]);
            }
            comboMods.push("wangpu/decoration/init");


            KISSY.use(comboMods, function (S) {
                var modsList = S.makeArray(arguments).slice(1);

                S.ready(function (S) {

                    if (window["g_hb_monitor_st"]) {
                        var domReady = (new Date()).getTime();
                        S.log("wangpu  dom ready spend time ms:" + (domReady - window["g_hb_monitor_st"]));
                    }

                    var D = S.DOM, modContext = {};

                    S.each(modsList, function (mod) {
                        initMod(mod);
                    })

                    function initMod(mod) {
                        if (mod.type == "base") {
                            modContext = {
                                pageType: initConfig.pageType,
                                mod: D.get('body')
                            }
                            new mod(modContext)
                        }

                        else if (mod.type == "decoration") {
                            modContext = {
                                pageType: initConfig.pageType,
                                lazyContainers: initConfig.lazyContainers,
                                isvParams: initConfig.isvParams,
                                mod: D.get("#content")
                            }
                            new mod(modContext)
                        }

                        else if (mod.selector == "#shop-head") {
                            new mod({ mod: D.get(mod.selector) });
                        }

                        else {
                            S.each(D.query(mod.selector, "#content"), function (modDomObj) {
                                new mod({ mod: modDomObj });
                            })
                        }
                    }

                    S.log("wangpu  init end");
                    var end = (new Date()).getTime();
                    S.log("wangpu  init spend time ms:" + (end - start));
                });
            });
        }
    }
    return Wangpu;
})

if (window.shop_config) {
    KISSY.use("wangpu/init", function (S, Wangpu) {
        Wangpu.init({
            "assetsHost": window.g_config.assetsHost,
            "pageType": "wangpu",    // 搴楅摵: wangpu, 闆嗗競detail:cdetail, tmall 璇︽儏椤�: tmalldetail, 璇勪环锛� rate
            "lazyContainers": "body",
            "isvParams": window.shop_config ? window.shop_config.isvStat : {}
        });
    }, true);
    // use锛坢odNames, callback, _forceSync锛� _forceSync涓簍rue 鏄负浜嗚В鍐虫窐甯淳鎵€渚濊禆鐨刱issy.config
}
